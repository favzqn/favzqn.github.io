<!--
  This is a critical style block to prevent flashing on page load in dark mode.
  It is injected into the <head> of the document before the main stylesheets are loaded.
-->
<style is:inline>
  :root {
    --bg: #ffffff;
  }

  html.dark {
    --bg: #1c1c1c;
  }

  html {
    background-color: var(--bg);
    color-scheme: light;
  }

  html.dark {
    color-scheme: dark;
  }
</style>

<script is:inline>
  // Minimal theme manager - optimized for fast first paint
  ;(function () {
    const STORAGE_KEY = 'chiri-theme'
    
    // Get theme synchronously to avoid FOUC
    const getTheme = () => {
      try {
        const stored = localStorage.getItem(STORAGE_KEY)
        if (stored) return stored
      } catch {}
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
    }
    
    // Apply theme immediately
    const theme = getTheme()
    document.documentElement.classList.add(theme)
    
    // Setup theme manager for later use
    window.ThemeManager = {
      getEffectiveTheme: getTheme,
      toggle() {
        const current = getTheme()
        const newTheme = current === 'dark' ? 'light' : 'dark'
        try {
          localStorage.setItem(STORAGE_KEY, newTheme)
        } catch {}
        document.documentElement.classList.remove('light', 'dark')
        document.documentElement.classList.add(newTheme)
      }
    }
  })()
</script>
